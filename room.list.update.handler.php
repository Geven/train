<?php
/*
 * create table chat7_room
 * (
 *      `id` char(11) unsigned NOT NULL,
        `name` char(30) default NULL,
        `color` char(30) default NULL,
        `description` char(11) default NULL,
        'userLevels' char(11) default NULL
        )
 *
 *
 *
 * */

header('Content-type: text/xml');
echo "<rooms>
<room>
<id>
RoomGroup0001
</id>
<name>
<![CDATA[Playroom]]>
</name>
<color>
0xFF6600
</color>
<description>
<![CDATA[Anything goes .. all adult.. all good times. NUDITY and PROFANITY are allowed in this room. Be courteous, use proper netiquette, and have fun! BE AWARE: MODs may judge some behavior as offensive and block accordingly and without warning NO DIRECTING....that is telling others to show body parts or to perform in any way is not acceptable behaviour.]]>
</description>
<userLevels>
s2member_level1,s2member_level2,owner,s2member_level2,supportteam,administrator,s2member_level1,subscriber,subscriber,banned,banned,,admin,sunscriber
</userLevels>
</room>
<room>
<id>
RoomGroup0002
</id>
<name>
<![CDATA[Welcome]]>
</name>
<color>
0x33CC00
</color>
<description>
<![CDATA[Hi there! Thanks for trying out iCU2x. We are an 18+ Members community of video chatters. Here are a few basic rules that apply in all rooms. 1. Impersonation of other members, owners, admin, moderators or law officials is strictly prohibited. Please report suspicious activity to help keep the community rooms safe. 2. Harassment is moderated actively. Please be courteous to other chatters. 3. No illegal, illicit activity. International and US laws apply and will be upheld by Admin, moderators and user reporting. Member created rooms may have rules or themes of their own. Start your membership today to access unlimited public rooms access, private messaging, whisper and send file features, drawing and your own profile space for socializing with other members. Have Fun! ]]>
</description>
<userLevels>
s2member_level1,s2member_level2,owner,s2member_level2,supportteam,administrator,s2member_level1,subscriber,subscriber,banned,banned,,admin,sunscriber
</userLevels>
</room>
<room>
<id>
RoomGroup0003
</id>
<name>
<![CDATA[Adult Chat]]>
</name>
<color>
0xFF6600
</color>
<description>
<![CDATA[Welcome Members. ~This room is now members &amp; previous subscribers only~ *Recommend setting mics to mute to start out.]]>
</description>
<userLevels>
s2member_level1,s2member_level2,owner,s2member_level2,supportteam,administrator,s2member_level1,subscriber,subscriber,banned,banned,,admin,sunscriber
</userLevels>
</room>
<room>
<id>
RoomGroup0004
</id>
<name>
<![CDATA[Seniors]]>
</name>
<color>
0xFF6600
</color>
<description>
<![CDATA[A lobby for our Seniors (50+ give or take.....) -No profanity -No Nudity in the chat -Be courteous, use proper netiquette and discretion MODS and ADMINS will warn you if you are being disruptive and if this continues they will remove you from the room.]]>
</description>
<userLevels>
s2member_level1,s2member_level2,owner,s2member_level2,supportteam,administrator,s2member_level1,subscriber,subscriber,banned,banned,,admin,sunscriber
</userLevels>
</room>
<room>
<id>
RoomGroup0005
</id>
<name>
<![CDATA[Music]]>
</name>
<color>
0xFF6600
</color>
<description>
<![CDATA[The Music Room is for those interested in playing and listening to music, a place to relax in the company of friendly folk. Feel free to join in the chat. Please respect the rules - appropriate behavior - courteousness to others - no nudity (we prefer faces to bare chests) - moderate swearing ... be nice and enjoy your stay. Mods and Admins will ban you without notice for not obeying the rules or trouble-making.]]>
</description>
<userLevels>
s2member_level1,s2member_level2,owner,s2member_level2,supportteam,administrator,s2member_level1,subscriber,subscriber,banned,banned,,admin,sunscriber
</userLevels>
</room>
<room>
<id>
RoomGroup0007
</id>
<name>
<![CDATA[Couples]]>
</name>
<color>
0xFF6600
</color>
<description>
<![CDATA[Couples are welcome here to have fun and chat ! Beware some behavior could be seen as offensive. Be courteous, use proper netiquette, and have fun. Mods and Admins may block you if you are disruptive.]]>
</description>
<userLevels>
s2member_level1,s2member_level2,owner,s2member_level2,supportteam,administrator,s2member_level1,subscriber,subscriber,banned,banned,,admin,sunscriber
</userLevels>
</room>
<room>
<id>
RoomGroup0008
</id>
<name>
<![CDATA[Gay Clean Chat]]>
</name>
<color>
0x9966CC
</color>
<description>
<![CDATA[The Gay Clean Chat Lobby...no nudity, no profanity....always be corteous.. BEWARE: MODs will block accordingly]]>
</description>
<userLevels>
s2member_level1,s2member_level2,owner,s2member_level2,supportteam,administrator,s2member_level1,subscriber,subscriber,banned,banned,,admin,sunscriber
</userLevels>
</room>
<room>
<id>
RoomGroup0009
</id>
<name>
<![CDATA[Bodybuilders]]>
</name>
<color>
0x9966CC
</color>
<description>
<![CDATA[The place to show off your rockin hot body and discuss body building Anything goes, from offensive talk, chat and pictures...if you are offended easily stay out Be courteous, use proper netiquette, and have fun! BEWARE: MODs may judge some behavior as offensive ]]>
</description>
<userLevels>
s2member_level1,s2member_level2,owner,s2member_level2,supportteam,administrator,s2member_level1,subscriber,subscriber,banned,banned,,admin,sunscriber
</userLevels>
</room>
<room>
<id>
RoomGroup0010
</id>
<name>
<![CDATA[Bi-Curious]]>
</name>
<color>
0x9966CC
</color>
<description>
<![CDATA[Are you bi-curious ? This is the place for you! Anything goes, from offensive talk, chat and pictures...if you are offended easily stay out Be courteous, use proper netiquette, and have fun! BEWARE: MODs may judge some behavior as offensive]]>
</description>
<userLevels>
s2member_level1,s2member_level2,owner,s2member_level2,supportteam,administrator,s2member_level1,subscriber,subscriber,banned,banned,,admin,sunscriber
</userLevels>
</room>
<room>
<id>
RoomGroup0011
</id>
<name>
<![CDATA[CD/TV]]>
</name>
<color>
0x9966CC
</color>
<description>
<![CDATA[For those interested in Crossdressing and Transvestism]]>
</description>
<userLevels>
s2member_level1,s2member_level2,owner,s2member_level2,supportteam,administrator,s2member_level1,subscriber,subscriber,banned,banned,,admin,sunscriber
</userLevels>
</room>
<room>
<id>
RoomGroup0013
</id>
<name>
<![CDATA[Gay Seniors]]>
</name>
<color>
0x9966CC
</color>
<description>
<![CDATA[A lobby for our Gay Seniors (50+ give or take.....) Anything goes, from offensive talk, chat and pictures...if you are offended easily stay out Be courteous, use proper netiquette, and have fun! BEWARE: MODs may judge some behavior as offensive and block accordingly]]>
</description>
<userLevels>
s2member_level1,s2member_level2,owner,s2member_level2,supportteam,administrator,s2member_level1,subscriber,subscriber,banned,banned,,admin,sunscriber
</userLevels>
</room>
<room>
<id>
RoomGroup0014
</id>
<name>
<![CDATA[Gay Nudists]]>
</name>
<color>
0x9966CC
</color>
<description>
<![CDATA[From offensive talk, chat and pictures...if you are offended easily stay out. Your MODS will determine behavior and block accordinglyFlooding the chat will result in a block from the chat room. Have fun and use discretion and netiquette.]]>
</description>
<userLevels>
s2member_level1,s2member_level2,owner,s2member_level2,supportteam,administrator,s2member_level1,subscriber,subscriber,banned,banned,,admin,sunscriber
</userLevels>
</room>
<room>
<id>
RoomGroup0044
</id>
<name>
<![CDATA[iCU2 Tips and Tricks]]>
</name>
<color>
0x33CC00
</color>
<description>
<![CDATA[Tips, Tricks, and FAQs to help you get to know your X. No nudity, profanity, or cam trolling please. This room is geared to helping users get to know their setups before venturing into topic rooms.]]>
</description>
<userLevels>
s2member_level1,s2member_level2,owner,s2member_level2,supportteam,administrator,s2member_level1,subscriber,subscriber,banned,banned,,admin,sunscriber
</userLevels>
</room>
<room>
<id>
RoomGroup0119
</id>
<name>
<![CDATA[TrivialPursuit]]>
</name>
<color>
0x0000FF
</color>
<description>
<![CDATA[Created by Paradox - Bot Commands: !start : will start trivia !scores : will list the top 20 scores ?? : will mark the current question for revision !msgin : use this to add a welcome msg when you enter the TrivialPursuits room. Simply type !msgin and then your message after that. !Rank : will post a link to an enhanced leaderboard at www.icu2.ws/trivia Please be aware that abuse of these commands may result in you being banned from playing trivia. ---- Please DO NOT post images (live snaps or uploads) OF YOUR GENITALS in the room ----]]>
</description>
<userLevels>
s2member_level1,s2member_level2,owner,s2member_level2,supportteam,administrator,s2member_level1,subscriber,subscriber,banned,banned,,admin,sunscriber
</userLevels>
</room>
<room>
<id>
RoomGroup0121
</id>
<name>
<![CDATA[Adult/Play with Music]]>
</name>
<color>
0x0000FF
</color>
<description>
<![CDATA[ ** A place to have adult fun and listen to music! **]]>
</description>
<userLevels>
s2member_level1,s2member_level2,owner,s2member_level2,supportteam,administrator,s2member_level1,subscriber,subscriber,banned,banned,,admin,sunscriber
</userLevels>
</room>
<room>
<id>
RoomGroup0123
</id>
<name>
<![CDATA[Pervs]]>
</name>
<color>
0x0000FF
</color>
<description>
<![CDATA[Anything goes in here.. if you are easily offended.. it is not the place for you!]]>
</description>
<userLevels>
s2member_level1,s2member_level2,owner,s2member_level2,supportteam,administrator,s2member_level1,subscriber,subscriber,banned,banned,,admin,sunscriber
</userLevels>
</room>
<room>
<id>
RoomGroup0124
</id>
<name>
<![CDATA[Smokers]]>
</name>
<color>
0x0000FF
</color>
<description>
<![CDATA[puff and pass]]>
</description>
<userLevels>
s2member_level1,s2member_level2,owner,s2member_level2,supportteam,administrator,s2member_level1,subscriber,subscriber,banned,banned,,admin,sunscriber
</userLevels>
</room>
</rooms>";

/*
define('APPLICATION', 'chat7'); //Allowed values: chat7, messenger7

require_once "./module/cms.config.handler.php";
require_once "./module/db.class.php";
require_once "./module/utils.class.php";

Db::dbConnect();

$sql = "SELECT DISTINCT(meta_value)  FROM `1_usermeta` WHERE meta_key = '1_capabilities'";
$result = mysql_query($sql); 

while($row = mysql_fetch_assoc($result))
{
           preg_match_all("/\"(.+)\"/sUi", $row['meta_value'], $matches);
           $levels[] = $matches[1][0];
}

$userLevels = implode(',',$levels);

$result = mysql_query("SELECT 
                            bg.id as id,
                            bg.name as name,
                            bg.description as description,
                            bgg.meta_value as color,
                            bgg2.meta_value as userlevels
                       FROM 
                            1_bp_groups as bg
                       LEFT JOIN
                            1_bp_groups_groupmeta as bgg ON bgg.group_id = bg.id AND bgg.meta_key = 'group_icon_color'
                       LEFT JOIN
                            1_bp_groups_groupmeta as bgg2 ON bgg2.group_id = bg.id AND bgg2.meta_key = 'bpge'
                       ");

$rooms = '';

function leading_zero($num)
{
    $num = str_pad($num, 4, '0', STR_PAD_LEFT);
    return $num;
}

while($row = mysql_fetch_assoc($result))
{
    $room_list[] = $row;
} 
   
foreach ($room_list as $row)
{
    $color = str_replace('#', '', $row['color']);
    
    $color = base_convert($color, 16, 10); 
    
    preg_match('/;i:(\d{4});/', $row['userlevels'], $matches);

    $queryResult = mysql_query("SELECT 
                                                        meta_key, 
                                                        meta_value
                                                   FROM 
                                                        1_postmeta
                                                   WHERE 
                                                        (meta_key = 'Group User' OR
                                                        meta_key = 'isPrivate' OR
                                                        meta_key = 'password') AND 
                                                        post_id = '".$matches[1]."'
                                                   ");
$roomResult = NULL;                                                  
while($metarow = mysql_fetch_assoc($queryResult))
{
    $roomResult[$metarow['meta_key']] = $metarow['meta_value'];
}

    $roomResult['isPrivate'] = strtolower($roomResult['isPrivate']);
    if ($roomResult['isPrivate'] != 'true') $roomResult['isPrivate'] = 'flase'; 
   
    //if (empty($color)) $color = '0000FF';
    $room_number = leading_zero($row['id']);
    
	$rooms .= '
		<room id="RoomGroup'.$room_number.'" color="'.$color.'" maxUsers="5000" isPrivate="'.$roomResult['isPrivate'].'" type="0" creatorID="">
		<name>'.$row['name'].'</name>
		<description>'.$row['description'].'</description>
		<password>'.$roomResult['password'].'</password>
		<userLevels>'.$roomResult['Group User'].'</userLevels>
	</room>';
	
	/*
    $rooms .= '<room>
            		<id>RoomGroup'.$room_number.'</id>
            		<name><![CDATA['.$row['name'].']]></name>
            		<color>0x'.$color.'</color>
            		<description><![CDATA['.$row['description'].']]></description>
                    <userLevels>'.$userLevels.'</userLevels>
               </room>';
	*/
/*}


$out = '<rooms>'.$rooms.'</rooms>';


echo $out;*/

/**
  <rooms>
  	<room>
  		<id>newRoom1</id>
  		<name>General</name>
  		<color>0x6699CC</color>
  		<description>General room</description>
  	</room>
  	<room>
  		<id>newRoom2</id>
  		<name>Sports</name>
  		<color>0x6699CC</color>
  		<description>Talking about sports</description>
        <password>123</password>
  	</room>
  	<room>
  		<id>newRoom3</id>
  		<name>Love</name>
  		<color>0x6699CC</color>
  		<description>Talking about love</description>
  		<userLevels>s2member_level1</userLevels>
  	</room>
  	<room>
  		<id>newRoom4</id>
  		<name>My Whiteboard</name>
  		<color>0x6699FF</color>
  		<description>Talking about love</description>
  		<type>1</type>
  	</room>
  </rooms>
*/
?>

